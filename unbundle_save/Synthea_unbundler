{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Script to load Synthea bundle and:\n",
    "\n",
    "- Unbundle using dict and add meta profiles\n",
    "- Save to USCore Validator and Validate\n",
    "- Create a second transaction bundle of Provenance Resources for each Resource\n",
    "- Load to FHIR Reference Server for further testing\n",
    "\n",
    "\n",
    "for some reason the pyFHIRR4 models for Bundle not working :-(\n",
    "\n",
    "- python version 3.6+\n",
    "- get data from folder\n",
    "- unbundle\n",
    "- display\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "metadata": {},
   "outputs": [],
   "source": [
    "from os import listdir, path, unlink\n",
    "from json import load, dumps, loads\n",
    "from requests import get, post, put\n",
    "from IPython.display import display, Markdown, HTML\n",
    "from fhirclient.r4models import bundle as B\n",
    "from fhirclient.r4models import provenance as P\n",
    "from fhirclient.r4models import narrative as N\n",
    "import fhirclient.r4models.coding as C\n",
    "import fhirclient.r4models.codeableconcept as CC\n",
    "import fhirclient.r4models.fhirdate as D\n",
    "import fhirclient.r4models.fhirreference as FR\n",
    "import fhirclient.r4models.meta as M\n",
    "from fhirclient.r4models.fhirabstractbase import FHIRValidationError\n",
    "from datetime import datetime, date\n",
    "from requests import get, post, put\n",
    "from uuid import uuid1\n",
    "from time import sleep\n",
    "from pprint import pprint"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### globals"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'2019-09-10T18:10:59.666266Z'"
      ]
     },
     "execution_count": 64,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\n",
    "types = dict (\n",
    "Patient = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient',\n",
    "AllergyIntolerance = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-allergyintolerance',\n",
    "CarePlan = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-careplan',\n",
    "CareTeam = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-careteam',\n",
    "Condition = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition',\n",
    "Device = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-implantable-device',\n",
    "DiagnosticReport = ['http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab',\n",
    "                    'http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-note'],\n",
    "DocumentReference = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-documentreference',\n",
    "Encounter = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-encounter',\n",
    "Goal = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-goal',\n",
    "Immunization = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-immunization',\n",
    "Location = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-location',\n",
    "Medication = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-medication',\n",
    "MedicationRequest = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-medicationrequest',\n",
    "Observation = ['http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-lab',\n",
    "               'http://hl7.org/fhir/StructureDefinition/vitalsigns',\n",
    "                'http://hl7.org/fhir/us/core/StructureDefinition/us-core-smokingstatus',\n",
    "               'http://hl7.org/fhir/us/core/StructureDefinition/pediatric-weight-for-height',\n",
    "               'http://hl7.org/fhir/us/core/StructureDefinition/pediatric-bmi-for-age',\n",
    "               'http://hl7.org/fhir/us/core/StructureDefinition/us-core-pulse-oximetry',],\n",
    "Organization = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-organization',\n",
    "Practitioner = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitioner',\n",
    "PractitionerRole = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitionerrole',\n",
    "Procedure = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-procedure',\n",
    "Provenance = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance',\n",
    ")\n",
    "\n",
    "r_list =[]\n",
    "\n",
    "in_path = '/Users/ehaas/Documents/FHIR/synthea/output/fhir/'\n",
    "#in_path='test/'\n",
    "out_path = '/Users/ehaas/Documents/FHIR/ArgoR4Validator/source/examples/'  # append forward slash \n",
    "#f_name = 'Denisse335_Stracke611_e760e08d-a0ff-4cd7-83c0-36b27dae6ec3'\n",
    "#f_name='Alaina222_Gleichner915_0e83bdc3-52c5-4e7e-ba92-174e711ba95c'\n",
    "\n",
    "f_now = D.FHIRDate(f'{datetime.utcnow().isoformat()}Z')\n",
    "f_now.as_json()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Get files"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "metadata": {},
   "outputs": [],
   "source": [
    "def open_file(in_path,f_name): # get files\n",
    "    with open(f'{in_path}{f_name}',encoding='utf-8', errors='ignore') as f:\n",
    "        r = f.read()\n",
    "       \n",
    "        return(loads(r))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### First Clear the directory"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 66,
   "metadata": {},
   "outputs": [],
   "source": [
    "def clear_path():\n",
    "    for filename in listdir(out_path):\n",
    "        file_path = path.join(out_path,filename)\n",
    "        try:\n",
    "            if path.isfile(file_path):\n",
    "               unlink(file_path)\n",
    "            #elif os.path.isdir(file_path): shutil.rmtree(file_path)\n",
    "        except Exception as e:\n",
    "            print(repr(e))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Write file to examples dir in IG"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def write_file(r_json,type,id): # write file  \n",
    "    with open(f'{out_path}{type}-{id}.json', 'w') as f:\n",
    "        #print(f'Writing to {out_path}{type}-{id}.json')\n",
    "        f.write(r_json)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Fetch Organization from the Bundle to create Provenance resource"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def prefetch_org(b):\n",
    "    #bundle = B.Bundle(b, strict=False)\n",
    "    #prov_org = (i for i in bundle.entry if i.resource.resource_type =='Organization')\n",
    "    orgs = (i for i in b['entry'] if i['resource']['resourceType'] =='Organization')\n",
    "    org_id  = next(orgs)['resource']['id']\n",
    "    return(org_id)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Post Transaction Bundle to reference Server"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def post_transaction(b):\n",
    "    # note that bundle b is a dict not a class\n",
    "    types = [i['resource']['resourceType'] for i in b['entry']]\n",
    "    display(HTML(f'<h1>bundle</h1><h3>resources</h3> {types}'))\n",
    "    #fhir_test_server = 'http://test.fhir.org/r4'\n",
    "    fhir_test_server = 'http://hapi.fhir.org/baseR4'\n",
    "\n",
    "    headers = {\n",
    "    'Accept':'application/fhir+json',\n",
    "    'Content-Type':'application/fhir+json',\n",
    "    }\n",
    "\n",
    "    # profile = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient' # The official URL for this profile is: http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient\n",
    " \n",
    "    params = dict(\n",
    "      # profile = 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient' # The official URL for this profile is: http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient\n",
    "        )\n",
    "    \n",
    "    r = post(fhir_test_server, params = params, headers = headers, data = dumps(b, indent=4))\n",
    "    display(HTML('<h1>Request Headers</h1>')) \n",
    "    pprint(r.request.headers)\n",
    "    #display(HTML('<h1>Request Body</h1>')) \n",
    "    #pprint(r.request.body)\n",
    "\n",
    "    display(HTML(f'<h1>Server Response</h1><h3>Status Code = {r.status_code}</h3>')) \n",
    "    pprint(r.headers)\n",
    "    pprint(r.json())\n",
    "            "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Create Provenance\n",
    "\n",
    "- Inputs:\n",
    "  - what resource is it about\n",
    "  - Prefetched Organization to use for the author and transmitter ( for now just one will do)\n",
    "- most everything else is a fixed value.\n",
    "- validate using the argovalidator  (load to examples)\n",
    "- add to bundle\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_agent_type(system,code):\n",
    "    \n",
    "    prov_type = CC.CodeableConcept()\n",
    "    prov_type_coding = C.Coding()\n",
    "    prov_type_coding.system = system\n",
    "    prov_type_coding.code = code\n",
    "    prov_type.coding = [prov_type_coding]\n",
    "    #print(prov_type)\n",
    "    return(prov_type)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_prov(org,target_type, target_id):\n",
    "    \n",
    "  \n",
    "    who_ref=FR.FHIRReference(dict(\n",
    "                reference=f'Organization/{org}'\n",
    "        ))\n",
    "                             \n",
    "    prov_target = FR.FHIRReference(dict(\n",
    "            reference=f'{target_type}/{target_id}'\n",
    "        ))\n",
    "    \n",
    "    f_now = D.FHIRDate(f'{datetime.utcnow().isoformat()}Z')\n",
    "    \n",
    "    prov = P.Provenance()\n",
    "    prov.id = str(uuid1())\n",
    "    prov.meta = M.Meta(dict(profile =[types['Provenance']]))\n",
    "    prov.target= [prov_target]\n",
    "    prov.recorded = f_now\n",
    "    prov.agent = []\n",
    "    \n",
    "    # this could be a function\n",
    "    prov_agent = P.ProvenanceAgent()\n",
    "    prov_agent.who = who_ref\n",
    "    prov_agent.type = get_agent_type(system='http://hl7.org/fhir/us/core/CodeSystem/us-core-provenance-participant-type',code='transmitter')\n",
    "    prov.agent.append(prov_agent)\n",
    "    \n",
    "    prov_agent = P.ProvenanceAgent()\n",
    "    prov_agent.who = who_ref\n",
    "    prov_agent.type = get_agent_type(system='http://terminology.hl7.org/CodeSystem/provenance-participant-type',code='author')\n",
    "    prov.agent.append(prov_agent)\n",
    "    \n",
    "    #print(f'created resource Provenance-{prov.id} for resource {target_type}/{target_id}' )\n",
    "    \n",
    "    return(prov)    \n",
    "    "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Loop through all entries and if US Core type change logical to literal reference and save\n",
    "\n",
    "#### Loop through entries and create literal to logical reference map"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def add_meta(r):\n",
    "    \n",
    "    global r_list\n",
    "                          \n",
    "    t = r[\"resourceType\"]\n",
    "    i = r[\"id\"]\n",
    "    if t in types.keys(): \n",
    "       r_list.append(t)\n",
    "       if t not in [\"DiagnosticReport\",'Observation']: # add meta profiles\n",
    "           r['meta']= (dict(profile =[types[t]]))\n",
    "       elif \"Observation\" == t:  # \"Observation\"\n",
    "           try:\n",
    "               #['vital-signs','laboratory','72166-2']:\n",
    "               if 'laboratory' in r['category'][0]['coding'][0]['code']:\n",
    "                   r['meta']= dict(profile =[types[t][0]])\n",
    "               elif '72166-2' in r['code']['coding'][0]['code']:\n",
    "                   r['meta']= dict(profile =[types[t][2]])\n",
    "               elif '77606-2' in r['code']['coding'][0]['code']:\n",
    "                   r['meta']= dict(profile =[types[t][3]])\n",
    "               elif '59576-9' in r['code']['coding'][0]['code']:\n",
    "                   r['meta']= dict(profile =[types[t][4]])\n",
    "               elif '2708-6' in r['code']['coding'][0]['code']:\n",
    "                   r['meta']= dict(profile =[types[t][5]])\n",
    "               elif 'vital-signs' in r['category'][0]['coding'][0]['code']:\n",
    "                   r['meta']= dict(profile =[types[t][1]])\n",
    "               else: # use lab\n",
    "                   r['meta']= dict(profile =[types[t][0]])\n",
    "                   pass\n",
    "           except KeyError:\n",
    "                   r['meta']= dict(profile =[types[t][0]])\n",
    "\n",
    "       else:  # \"DiagnosticReport\"\n",
    "           try:\n",
    "               if 'LAB' in r['category'][0]['coding'][0]['code']:\n",
    "                   r['meta']= dict(profile =[types[t][0]])\n",
    "               elif r['category'][0]['coding'][0]['code'] in ['LP29684-5','LP29708-2','LP7839-6',]:\n",
    "                   r['meta']= dict(profile =[types[t][1]])\n",
    "               else:  # use lab\n",
    "                   r['meta']= dict(profile =[types[t][0]])\n",
    "                   pass\n",
    "           except KeyError:\n",
    "               r['meta']= dict(profile =[types[t][0]])\n",
    "                \n",
    "    '''\n",
    "    try:\n",
    "        print(f' update resource {t}-{i} with meta {r[\"meta\"][\"profile\"][0]}' )\n",
    "    except Exception as e:\n",
    "        print(repr(e))\n",
    "    '''\n",
    "              \n",
    "    return(r)\n",
    "  "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "### Validate Bundle entries using US Core Validator"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def validate_me(bundles):\n",
    "    for b in bundles:\n",
    "        for e in b[\"entry\"]:\n",
    "                r = e[\"resource\"]\n",
    "                r_id = r[\"id\"]\n",
    "                #print(f'id = {r_id}')\n",
    "                t = r[\"resourceType\"]\n",
    "                #print(f'type = {t}')\n",
    "                # convert all logical to literal references\n",
    "                r_string = dumps(r,indent=4)\n",
    "                for ref_id, ref_type in ids.items(): \n",
    "                    r_string = r_string.replace(f'urn:uuid:{ref_id}',f'{ref_type}/{ref_id}')    \n",
    "                # validate using the validation build\n",
    "\n",
    "                write_file(r_string,t,r_id) # validate using the argovalidator (load to examples)\n",
    "    display(Markdown('**All files loaded onto Validator - run IG-Pub using -d option to validate**'))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Main File call all the functions above"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<h1>bundle</h1><h3>resources</h3> ['Patient', 'Organization', 'Practitioner', 'Encounter', 'Condition', 'Goal', 'Goal', 'Goal', 'Goal', 'Goal', 'CarePlan', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Condition', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Procedure', 'Immunization', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Procedure', 'Immunization', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Immunization', 'Immunization', 'DiagnosticReport', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Organization', 'Practitioner', 'Encounter', 'Condition', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Condition', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Procedure', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Immunization', 'Immunization', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Condition', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Immunization', 'DiagnosticReport', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Procedure', 'Immunization', 'DiagnosticReport', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Condition', 'Observation', 'MedicationRequest', 'Claim', 'MedicationRequest', 'Claim', 'CarePlan', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Immunization', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Immunization', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Procedure', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Immunization', 'Immunization', 'DiagnosticReport', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit', 'Encounter', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Observation', 'Procedure', 'Immunization', 'DiagnosticReport', 'DiagnosticReport', 'Claim', 'ExplanationOfBenefit']"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<h1>Request Headers</h1>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'User-Agent': 'python-requests/2.20.0', 'Accept-Encoding': 'gzip, deflate', 'Accept': 'application/fhir+json', 'Connection': 'keep-alive', 'Content-Type': 'application/fhir+json', 'Content-Length': '953067'}\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<h1>Server Response</h1><h3>Status Code = 200</h3>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'Server': 'nginx/1.14.0 (Ubuntu)', 'Date': 'Tue, 10 Sep 2019 18:11:27 GMT', 'Content-Type': 'application/fhir+json;charset=utf-8', 'Transfer-Encoding': 'chunked', 'Connection': 'keep-alive', 'X-Powered-By': 'HAPI FHIR 4.1.0-SNAPSHOT REST Server (FHIR Server; FHIR 4.0.0/R4)', 'X-Request-ID': '16d9750a5ee3aa27', 'Content-Location': 'http://hapi.fhir.org/baseR4/Bundle/4ca31272-268d-4adb-b7b1-6168a6da2138', 'Location': 'http://hapi.fhir.org/baseR4/Bundle/4ca31272-268d-4adb-b7b1-6168a6da2138', 'Content-Encoding': 'gzip'}\n",
      "{'entry': [{'response': {'etag': '1',\n",
      "                         'location': 'Patient/8b42051b-e45b-4032-926a-747affe4e09d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Organization/ccbd6376-81a6-35c8-93d1-d6d519e417d6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Practitioner/0000016d-1435-7d38-0000-0000000140e6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/8e564eff-78c1-4118-ad1f-561aad40d1c6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Condition/4d49ffd0-addf-414b-abf6-b4657d18112b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Goal/27e1b0a2-0daf-4d97-997c-9dd722e0a5b6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Goal/7345e82a-c3e5-4ae2-9400-06920f373d41/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Goal/73c13ee7-169e-4e61-9f56-7419a847cbe8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Goal/53c3a997-68a5-4c62-8702-d3e2ad3b0ee5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Goal/16e09a8f-de27-4079-bf87-eda298e103cc/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'CarePlan/56cdb904-df36-4647-8fe4-4639b505af29/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/d20f2c61-fc57-4e33-823e-98148d34977d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/e5d86de6-e93e-4e83-8b0f-9092f3e12add/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/d7da70d5-0de0-4229-bee8-dac7b52e3b8f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Condition/66ee2742-9a7d-42f5-bd3b-db7e74ba68f4/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/1cc4b1a5-c7d3-4314-ab87-90340f1a674f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/001a404f-8262-4a8f-a497-a64b39ba6f7c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/d8827a4c-126e-4068-8939-5e08a2bcd24e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/5ebd090d-990c-4732-aa63-f45ecca2650d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c9744202-5b66-4b27-8fa6-cea12d6bb023/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/da4b5409-f46d-4dc4-a9ef-7ab8866192d5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f718a505-78af-4c3b-9a18-df84dbd2a34a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/88e9b9d7-f86b-4406-be73-7dfd49f6a573/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/1a7f1b30-c078-46b6-a25e-f2e6cc8d8aaa/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/face2f38-83c8-45cc-99b3-881a4716ecdf/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/6cfc3c23-f890-4517-a167-a3f21289470a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d863d50f-bcbb-4a84-8859-3dfc0f203064/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/e0bacab4-682e-4083-a0f0-327d9fe29fb2/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/41dc811a-b657-4872-b77d-a37b8679e7c4/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/00ed78ff-9586-49fa-b94d-a0196be9c89e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/4baff733-3b16-4bed-b323-8e62e04fdb8b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/30696e43-121b-4fc3-a954-94fb19e64351/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f77cc565-831d-4c66-83cc-6884ddc25607/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Procedure/7572e5f0-ccfa-4cb0-8381-69a7cfe0a3dd/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/030fa2ba-567a-4fdf-9e66-e16f8c4a138c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/face2f39-1e8a-4a92-80dd-91637970c2fb/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/0f70e9c4-8bd1-4e7a-8901-167cb035456d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/6f0678b4-b3d7-4fe5-b90c-ceb2a276643a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/ce60749f-fdec-4983-8101-7af05f65ef94/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/2b45808f-9d19-4973-899a-05967c5ba02b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/fd00b5e9-3a97-43ed-9cc4-4d8eaf5ca440/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/1d3cfd65-67f0-43b9-849b-7ccd759da29e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c4534b2a-685c-4b4a-a51b-2674805fc113/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/2b381ef7-4c5d-4ca9-95eb-a9a9c613360d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/6a040ace-3ecd-49bf-a6c6-49b7317ec962/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/17e8bb02-2378-4767-8d20-0a3cb1d318d9/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/056ef629-e52e-4ded-8a1c-99364befe4c1/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/7d45bc5a-d341-47e9-9bdd-c94cecbc249d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/8e891374-9554-4666-8991-27f2192b5979/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/7ce6f644-ca00-4504-a3f6-825c6342a30c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f73ef752-4138-4729-8274-5079b71ca7f5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/7cfeac3b-11ec-48bb-aa68-2f06b0480d61/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f2b0ac63-22bd-4b43-b749-7dd5ef6f5d3f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/40280ab5-fbc2-4ad0-b397-2f60916b06e0/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Procedure/29bbde42-9fd3-4b65-ac4e-f9d3e385e215/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/53382388-e1a7-4dfe-af05-daa9d3865744/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/5b8ad03c-d89b-4d0b-9676-5c3f6477a367/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/6b5d47b8-ff50-43e0-9f54-ebe5278c6fda/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/16ccea01-7f32-4e8a-ade3-b8f6fa3c38b7/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/c54c0036-7d57-4127-b0b4-7824ea18b861/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c60fff56-e2aa-46fc-8cf6-1f1b661cccc5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d6e618f9-6109-4397-9e68-14f561a476c8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d653048e-bfc9-48b8-ab9b-b6af358388dd/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/86b67ec4-d8a3-4734-84c1-a6d693e76bea/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ca009313-fb48-47a1-b3aa-1ea9a30cde6f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/814d5529-94b9-4cff-a787-3d7ec99bc858/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c447b203-d82d-43cb-9782-bf3a482e9fc8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9c8105c0-a9cc-4b72-810e-9c4993bf88e3/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/1e422f60-ef73-4d9a-a1cd-b83763540a82/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c5263a13-d410-4418-ad40-edb33ae17f70/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/06e855fd-ecdf-4c72-abb7-fd5926c1dff2/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/93e85260-9da8-4da1-817b-2db8a5a17ebe/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/6d58ad15-b45a-4a43-a8c2-2917bcd6fda6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9c233204-d1fc-40fa-b0a9-900771c35d35/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/67b59f76-7ccd-45ee-a313-f20a59bc9f16/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9bdff011-90ee-4ac6-bea8-93e9defe2bd4/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/2359fe12-5bed-4f91-9c03-b6c21d93d03e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/deeb33a4-e032-4576-8c75-6e24ca76c523/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/52dde104-9f46-4daf-a398-e1a56c6f7d41/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/cd0d7483-f477-400a-88c2-7ed2c82fdc46/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/3ae05277-d08a-4b07-a3af-7bc4f7ce96f5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/b156c094-d4a0-4e24-a60a-dbf60d55980f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/0b52755f-85b5-4d2f-941d-83fb953f0ae3/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/f7ed518b-5686-4280-a3bd-d946adf91ddf/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/4b53f6d4-f023-4d8d-8c7d-00f987bd2da5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Organization/c44f361c-2efb-3050-8f97-0354a12e2920/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Practitioner/0000016d-1435-7d38-0000-0000000000c8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/7439954a-3abe-4c10-8bf5-d2421d453dd2/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Condition/7049e8e9-b5a0-4b68-ba20-376f201202d0/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/ef303436-cf41-4a80-8ce8-23236e2c203a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/81d92601-39fd-4726-ae53-8e021d2d7d4f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/c7c272a3-1470-4802-98ea-8366adb339c3/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Condition/4592faa8-c7d9-4cd3-a85c-d45fcaecfa6d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/ee1b8a79-3a23-491e-b661-96f1d2ae34b8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/ef5e81b1-3b1a-49b0-9ead-0eecc59d1005/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/41fe04e8-e15d-4c78-ba4f-84d05f4b5f87/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/0ae942bb-1aeb-4c39-ad4d-ffd31100ee08/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/422e377d-f97d-4dd9-8f7d-43f150fa8457/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/0fd6b5e3-db43-405e-83e6-74aaab5f8a98/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/72be6be5-eed8-4a4c-a210-0aed7aa8fd48/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/2634a163-1cb3-41c7-9ba4-2b4af8ab0728/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/cb1d171a-c16a-4083-a28f-56514e9d4f31/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/39f275f3-2450-4a1b-997d-e4acd32a6a2f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/735d8b44-7229-4e8f-bca9-fc4d07acd4a5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/942493be-d608-47b5-b676-2bfdf2a5c692/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Procedure/dd8122e9-1e68-4df8-a40a-9b15195ddb75/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/9dfe3ec7-f59a-4840-8424-8a702d905400/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/6d0ded26-d37f-4cb7-b704-725392938422/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/be7f3abc-5dc3-4900-8168-47748e78c604/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/47b850ef-d06d-4b5b-9ce9-b75439d46915/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9b68f15a-c4eb-4268-96f8-f81fd7b541c3/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d293a376-8667-4c7c-913b-8423a964a971/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/3a23cadd-eb07-4a3e-a183-876d293519b5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9d21d962-3126-4dd2-b765-536499f4566f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d56c168b-3e8d-4429-9711-3d7e61116a59/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/e7cadfda-b3f6-47ca-812b-44b896fc2dc4/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/bfa556f7-2ba8-4084-813f-f80a2875b9f6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/cb45a3aa-7db2-497f-a026-d04f7f825692/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/002aaa70-d782-46c0-90cd-b13697f3ed7c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9cbbc4a1-4082-4b64-a0af-684fd7dd34d6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/e1df80d8-9395-4f3a-ac3b-cc9fa571d85f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/cea772e3-516d-4106-8cdc-bdbbc30efdad/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/235147e1-b707-4eb0-b6a8-cb4bf46ff462/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ac053785-ae62-4cb1-9ac9-bc9a31fb32c0/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/dbe64b1b-b73d-44d4-be55-f2b16e5f4de9/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/abde03d5-2350-49ec-941a-c5d0d8a71fda/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/3abd8acc-cebd-4122-a64c-3d36beeb980b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/e675bbcf-d910-48df-9255-d99d32574420/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/988eada2-8378-4990-8d5f-65adcc144fcf/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/90ae603a-cf77-4cde-afdf-5ad8510a88c0/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Condition/cfd26f54-26c4-464c-b584-60b0ca37b846/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/6d13a1f2-593e-43c8-95ce-8deecf1f5bc7/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/a33d5c6a-2ff0-47fa-8d75-4b88b34b6092/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/77ef1756-200a-49bf-ab3a-445e494db472/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/63e5b3b4-6567-4801-91bc-63a50954727b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/3897e194-3b6c-4ece-ba86-692d43b4b8fd/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/7ae85908-866a-4802-957a-05356d1de6df/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/fb6ca7c7-acc2-49ee-9cbf-7107d195bf3b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/69b0a79e-6563-45a5-9141-3f96d7080f83/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/41cea248-c2ae-4b75-9d17-248d0b64ab34/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d8812eb8-fd9a-4260-908a-0764df7a16bc/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/07ecfafe-cc6b-4867-8238-2bde4f1433d6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/0951c8fa-072c-4c17-bf54-00f6fb5f0a4d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/fd690637-6b1e-4e82-ba41-d8fee79c4dd5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d9acdfbd-7679-4385-bcc3-6376a2eb8621/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/a1c7aa20-94a1-41e9-b0de-788aa402afc0/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/b6edee06-c143-4828-b703-a9f0a83566a5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/888680d3-544e-48e8-ae41-05499dc27102/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/0b27d5de-6800-4dfb-9135-7c194f91fb71/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/bde79b7f-dbff-4bee-97d9-7926288a4638/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9a6048b0-3bed-4b21-8af9-a2f193b00221/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/cea53d05-f8a0-48d5-b74e-b881f6615b42/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/5e985ef7-c4f6-4be8-a6e1-bb42cf78a4ff/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/6329f4b9-1f2f-4b00-a97c-b6cfc2050fd1/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/b1f201e7-58c9-4214-b66c-cc397084e5b0/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ad85e679-6d02-4a8e-b9ba-83c47b7abc98/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f1d31bab-e477-4667-9b56-761c06d181df/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/12cc3ec8-f9ef-440f-b2bb-1c0601c1d80a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9ecf5de2-4478-4ba0-a0af-0cd0b83bcf56/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f6f2686f-8581-49e2-978b-0aadced174d8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/e0d1d37b-577a-403e-a4c1-97d4cb1f661d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/9dd5f338-bf20-4f55-acb5-42b3e69bccfb/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/bc928ed9-217b-4b55-a96b-61d5ee898680/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/41ff9adc-b5b3-488d-a2aa-09af2e7f645a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/17493e1f-7b12-45b0-aa9d-83e2df22078e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/c08303bd-a651-4088-9964-57f436707a1d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/6ffb7f23-d66c-4862-8e85-96df296be21f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/696878a4-8df0-4b7e-a16f-dbdac64842a9/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/2d15db07-c0bb-4b4c-8191-83c4b3e9747b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/b9cb3077-4f33-4e13-a257-aa09319b5aab/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/266907b1-c75f-4580-85f1-c3f73904b26d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/4d171e48-be10-45e7-8cbf-bb8af7ae970f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/3eaffbb5-976f-468b-b954-3cd889673182/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/0f91b443-ba3e-4ae3-80b7-a3b418363f4f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/365b326d-852b-466e-b900-0c9ecafc1e85/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/4c9f6a92-c3b2-4e4d-993d-6a90c6ee4587/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/01353721-ff14-44b6-93b5-6aed63105417/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/df092335-3874-492c-b6c8-d2577eda1ae8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/12461e6c-416f-4d0e-8970-df875565a266/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ec09a795-41a3-4365-acca-65e5b1fc62cc/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/7ffb1ce4-8850-4205-8a24-90c4c0d19bea/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/672d7a9e-1723-439d-8310-ae60129c96e8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/6cc0b3bd-e271-473a-8c68-8bc0de93d4df/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f526cf77-bd80-4ca9-b516-f98b7d611aa7/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f1e47d0b-ae45-4b4b-8992-9999b79a3e98/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Procedure/6c232176-574b-426f-81a4-5e020bf753c9/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/04d3f2c0-f2ae-4844-a403-2423622000ff/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/015babb7-7ef0-4a9b-84a4-de914511eabe/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/22ccddd8-bd77-466c-b5d6-81bee0ca5bd5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/732a0bcb-d91a-4461-bb36-739de8a2aa89/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/d4e45e81-dce9-482b-b162-ac65da76ed7b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/6a4741ed-47a2-4afb-9f21-af445dd543f1/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Condition/3396d919-4907-45bc-986b-f5cc5b9905bc/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9e68f54f-d3cb-458e-89cb-80a8421c50c1/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'MedicationRequest/9a46a876-a000-40d9-a9ae-5c06056bfc07/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/5156d2d2-c903-42ad-b5de-401e3d7ff730/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'MedicationRequest/c8c7e8e8-c159-45c9-9474-6b9b2b07e29c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/88e425c7-b541-4e35-a539-c94de137b536/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'CarePlan/cef759cf-f476-4d20-bc4c-5749cf7130f0/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/1fb2dc1c-83f9-444e-8e11-75b9485b84f1/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/9417dfb4-9245-48f8-b8f2-e378c214c1db/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/7fcd56a0-e1dd-41ff-8e38-ccc3b8f5f911/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/52f8810e-e0d0-448d-b5e0-894de4b44a4d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/629c82b6-de0e-4850-b1cd-7541b9f42391/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/04732c06-018d-4098-b6b4-07d059a52825/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/57d0387d-4f54-4a6f-a062-7109338bf424/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/4afc83f7-819e-4f50-8ca7-96f60fe59c4b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/8406c10f-68e5-4143-b47b-07708b39c867/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d343fd31-7b00-4228-b090-1c9205e02284/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/7d658bfd-b94e-4398-a303-78c115c4f832/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/14fb93eb-39de-4ce1-8930-00a09417030c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c36bb904-98c5-4fda-830e-fbb5368f9fc4/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f148edcb-898b-4488-a164-a1e21de3807f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/abdacfae-4bf9-4725-b64d-e96e4feb620d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d3be90b9-cf6a-4ece-b0da-940824b4f8df/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c79562ac-7167-40b5-8401-8a9343ff40be/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/b53c8e02-a348-4f92-8ed4-fb3f231d1133/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/2a02722b-fd83-422a-8ebe-64477da54242/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/5c1f4750-89f9-4107-be95-a8dce483ebd4/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/b830b643-07a1-45b5-b291-1909453be10d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/58f0dff2-3310-4894-bede-dee3325be497/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/57cc5e10-bb5e-4047-944d-e09c79d41e2b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/b28f405d-d80c-42f4-b7fe-8904cb71a89b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f3aa2be7-dd7d-42ab-b9ff-bcf63c6426e8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/fb5aec43-12e8-403a-a0d7-7ff2a200bebd/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/cfdce8df-cc5f-493b-b726-687926682b00/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/98ebcb07-7598-4ac4-9dbb-b5bc1d31742f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/44d10b54-b5c5-4a54-9acd-3ca017a29b4e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f7a8bf89-8750-402b-8274-c4e285cb1612/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/996bda0d-1f99-4548-b35d-aa14a5ecf981/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ec99cf93-0bc1-43bc-8b7d-94068333bc14/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/042fee8f-85da-4bd3-b4ca-d4c56a7b0e04/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/565c193b-67f4-452e-9612-fee3f4baf1b6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/496b4319-0fec-4558-9115-b2772da64247/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ec9abdda-618b-4a28-9a90-38b524c1465a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f9da2ad7-fea2-4c7f-9903-c98380cd9e6d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/48900bdb-1ead-4e22-bcda-cb5a5f13a426/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/0b262ea8-0103-4349-8c62-befa2db9fd97/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/648a8d46-7050-4963-a3cc-cf4695ac6b9b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/ea7ccc69-78e0-4919-b297-94930e046edf/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/81077a95-3e00-4417-84aa-660399722ffd/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/b3b6cf5f-77d4-4caa-a3db-6332fee4b5cc/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Procedure/1b6cece5-2997-47b7-a332-91abf5afd83b/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/7c42d746-ce5b-4ced-89fe-e339d73838ff/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/bc595fc3-152f-496f-9a26-5dfd10913436/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/afbdacb5-48fc-41ce-bc9a-f0c95e71eb8e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/3dcade53-e25f-44db-b909-00654db361dd/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/bc82b436-c734-43ac-bc5a-334712fad7ed/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ffd759a6-1f8f-49e3-8afb-044e995aaf06/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f4208da3-598e-4d08-a065-27d63305c03c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/a71e5bec-3903-43ac-a624-1654513f7293/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ad30892e-e9bf-4d50-afda-58bf70e79e6c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f00f38de-ba94-4647-a6a5-1a8f9c74e599/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/8d90e9e4-7e24-488e-9818-6da5c7c45fa5/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/2d5629d1-dd79-4802-bae7-9efc2c98d476/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d0a4118a-a5df-4f51-b1f0-afbd69e05dfb/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/64d0b7ec-3d2b-4787-bbc2-f3ddc9f43e3d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/77d15823-0359-49f2-8e78-6272d836b0d9/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/b3a06ba6-42af-41e9-b6d2-90893dff370e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/ebb29787-d4ab-42d0-ad94-c726fd09627c/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c4e6c074-1f5c-41e9-b7e2-aa59b77e5023/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/757dd545-c31a-4e63-ab58-c8463e4329fb/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/39e684b7-36ac-45a0-b139-079fe05d6e87/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/61a86121-ef19-40bc-bb5c-3b03992d8a9f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/9a100513-a614-454c-8716-7ae542af0515/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/c8935449-a399-4758-87e4-e8ec45a88ea9/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/915f4013-9b8b-47fb-96ce-587bd5371524/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/8b9dddef-0a61-4caa-aa9e-0b71aa189c24/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/72c83695-d824-47f5-9825-2559c6483357/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/87d8eb18-e249-4bad-8b7d-718d45203799/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/f40ab3d7-40b3-47df-9527-0ebd10bc91ac/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Encounter/faecae6c-bb04-4157-a905-2241125a2d9d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/fe93cc20-36fc-41b6-8ee6-049ccbd25fb6/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/b49227be-b770-4114-bde1-e46513b7ab4a/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/a054d763-7f74-404d-956b-9fc1dd7d6bcb/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/586f0340-b013-41e2-89c0-52d2df6656b3/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/5303ae8d-e345-4f98-a1ed-4aaf82da4176/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/bc13dbd2-8264-447e-9cf6-0813f68d6e1e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/e232cca4-fe29-4f6c-ac9f-cdc48927c6ce/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/81ba131e-ce1c-49ab-837c-e4ddd5d6c11f/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/f668c896-b568-4141-bdae-fe70c6cf0a22/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/8fdebed9-d62b-4cda-ab6e-dc5f54a1390e/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/834e643d-954f-4368-a668-01a78cf88d79/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/66b64a2f-499f-4843-bbca-c863d544d764/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d959fdb0-fd64-41b2-9bea-3e34b3162e76/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/2aa5ddd8-9370-4b5b-9a07-78245a528926/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/636e308a-0b5c-487f-ad52-561629eaade8/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/e0068e70-2ae7-409d-a99e-240c2cc51540/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/33ab4c3c-dec4-4eb8-9525-261f06bb460d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/627c40c4-6799-4507-b454-b6bdbf10d0fc/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/6e1ca759-0dee-4255-b0f3-fb956beb23fa/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/03d19875-aeb6-4f56-915e-c6f880f631b9/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/0746d397-c0f0-47dc-87d4-207855698d70/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/c150b6ff-ec20-4d95-8244-7c211a5cfc7d/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/4a6fe477-9f57-4a51-b449-a436ea740c83/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/d00f9d47-0ada-4c81-b1b9-9e959557b168/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/17dbc57a-f231-4b38-806b-f8c6fd4c3529/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Observation/8580ea47-fbee-4360-bf03-a8dd301d0d34/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Procedure/b052a0f6-85d7-4ea4-9577-70911d9513ad/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Immunization/70761a94-d8eb-456d-92b7-b512bd4ac968/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/3cfa7f92-a25e-4f8a-a7a2-556de5bf6efb/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'DiagnosticReport/acbae331-61b7-4ae4-b4fd-77fe4df1b7b1/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'Claim/0a6348a7-7325-46b2-a1da-f3aea335ddfa/_history/1',\n",
      "                         'status': '200 OK'}},\n",
      "           {'response': {'etag': '1',\n",
      "                         'location': 'ExplanationOfBenefit/a2e92299-91b9-44bd-a0d7-492e0b62b493/_history/1',\n",
      "                         'status': '200 OK'}}],\n",
      " 'id': '4ca31272-268d-4adb-b7b1-6168a6da2138',\n",
      " 'link': [{'relation': 'self', 'url': 'http://hapi.fhir.org/baseR4'}],\n",
      " 'resourceType': 'Bundle',\n",
      " 'type': 'transaction-response'}\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<h1>bundle</h1><h3>resources</h3> ['Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance', 'Provenance']"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "clear_path()\n",
    "for file in listdir(in_path): # assume is synthea pateint bundle.\n",
    "    ids = {}\n",
    "    provs = []\n",
    "    if file.endswith(\".json\"):\n",
    "        #print(\"json file found:\\t\", file)\n",
    "        b = open_file(in_path,file)\n",
    "        new_b = b\n",
    "        org_id = prefetch_org(b) # for provenance\n",
    "        #print(f'Provenance Organization url will be: Organization/{org_id}')\n",
    "        for e in b[\"entry\"]:\n",
    "            r = e[\"resource\"]\n",
    "            r_id = r[\"id\"]\n",
    "            t = r[\"resourceType\"]\n",
    "            # get a list of id's to create literal references later using a string replace \n",
    "            ids[r_id]=t\n",
    "           \n",
    "            e['resource']= add_meta(r) # add meta elements to resource\n",
    "            \n",
    "            #change POST to PUT and update the URL\n",
    "            e['request']['method']='PUT'\n",
    "            e['request']['url']=f'{e[\"request\"][\"url\"]}/{r_id}'\n",
    "            \n",
    "            # create provenance and add to list\n",
    "            provs.append(get_prov(org_id,t,r_id)) #create corresponding Provenance resource and add to list\n",
    "            \n",
    "        # create a transaction bundle provenance ,stick with dict type\n",
    "        pb = dict(\n",
    "            resourceType=\"Bundle\",\n",
    "            type=\"transaction\",\n",
    "            )\n",
    "        \n",
    "        pb['entry'] = []\n",
    "        for p in provs:\n",
    "            ids[p.id]='Provenance'\n",
    "            \n",
    "            e = dict( # no fullURL for now - use relative literal references\n",
    "                resource = p.as_json(),\n",
    "                request = dict(\n",
    "                    method='PUT',\n",
    "                    url= f'Provenance/{p.id}',\n",
    "                    ), \n",
    "                )\n",
    "            \n",
    "            pb['entry'].append(e)\n",
    "            \n",
    "            \n",
    "  \n",
    "        #write bundle to temp file to test manually\n",
    "        for i, bundle in enumerate([pb,b]):\n",
    "            with open(f'test_bundle_{i}.json', 'w') as f:\n",
    "                f.write(dumps(bundle, indent=4))\n",
    "            \n",
    "        # *********validate using the validation build ********\n",
    "        # cycle again\n",
    "        #validate_me([b,pb]) \n",
    "        \n",
    "        \n",
    "        #*********load bundles to FHIR Server - DOES NOT WORK - USE POSTMAN INSTEAD ***********\n",
    "\n",
    "        for bundle in [b,pb]:\n",
    "            r = post_transaction(bundle)\n",
    "            sleep(15)\n",
    "\n",
    "print(f'number of example resource = {len(r_list)}')          \n",
    "print(f'US Core types = {types.keys()}')\n",
    "print(f'Synthea types {set(r_list)}')            \n",
    "print(f'What is missing {set(types)-set(r_list)}')\n",
    "\n",
    "print('======Fin======')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
